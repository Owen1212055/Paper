From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Tamion <70228790+notTamion@users.noreply.github.com>
Date: Sun, 5 Nov 2023 09:51:28 +0100
Subject: [PATCH] Add HiddenPotionEffect API

== AT ==
public net.minecraft.world.effect.MobEffectInstance hiddenEffect

diff --git a/src/main/java/org/bukkit/craftbukkit/potion/CraftPotionUtil.java b/src/main/java/org/bukkit/craftbukkit/potion/CraftPotionUtil.java
index 844fb8c662a409670f631228f687d85c5436d3dd..c1bee1bab90908f7a985e12e27d94a0ce7d9cf90 100644
--- a/src/main/java/org/bukkit/craftbukkit/potion/CraftPotionUtil.java
+++ b/src/main/java/org/bukkit/craftbukkit/potion/CraftPotionUtil.java
@@ -72,17 +72,19 @@ public class CraftPotionUtil {
     }
 
     public static MobEffectInstance fromBukkit(PotionEffect effect) {
+        if (effect == null) return null; // Paper
         MobEffect type = CraftPotionEffectType.bukkitToMinecraft(effect.getType());
-        return new MobEffectInstance(type, effect.getDuration(), effect.getAmplifier(), effect.isAmbient(), effect.hasParticles(), effect.hasIcon()); // Paper
+        return new MobEffectInstance(type, effect.getDuration(), effect.getAmplifier(), effect.isAmbient(), effect.hasParticles(), effect.hasIcon(), fromBukkit(effect.getHiddenPotionEffect()), type.createFactorData()); // Paper
     }
 
     public static PotionEffect toBukkit(MobEffectInstance effect) {
+        if (effect == null) return null; // Paper
         PotionEffectType type = CraftPotionEffectType.minecraftToBukkit(effect.getEffect());
         int amp = effect.getAmplifier();
         int duration = effect.getDuration();
         boolean ambient = effect.isAmbient();
         boolean particles = effect.isVisible();
-        return new PotionEffect(type, duration, amp, ambient, particles, effect.showIcon()); // Paper
+        return new PotionEffect(type, duration, amp, ambient, particles, effect.showIcon(), toBukkit(effect.hiddenEffect)); // Paper
     }
 
     public static boolean equals(MobEffect mobEffect, PotionEffectType type) {
