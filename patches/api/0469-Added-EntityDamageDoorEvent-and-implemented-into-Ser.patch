From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: CMarcoo <cmarco.org@gmail.com>
Date: Thu, 14 Mar 2024 17:04:43 +0100
Subject: [PATCH] Added EntityDamageDoorEvent and implemented into Server.


diff --git a/src/main/java/io/papermc/paper/event/entity/EntityDamageDoorEvent.java b/src/main/java/io/papermc/paper/event/entity/EntityDamageDoorEvent.java
new file mode 100644
index 0000000000000000000000000000000000000000..403ede1eece18d5b70117a789f27903887525581
--- /dev/null
+++ b/src/main/java/io/papermc/paper/event/entity/EntityDamageDoorEvent.java
@@ -0,0 +1,125 @@
+package io.papermc.paper.event.entity;
+
+import com.google.common.base.Preconditions;
+import org.bukkit.block.data.BlockData;
+import org.bukkit.entity.Entity;
+import org.bukkit.event.Cancellable;
+import org.bukkit.event.HandlerList;
+import org.bukkit.event.entity.EntityEvent;
+import org.jetbrains.annotations.ApiStatus;
+import org.jetbrains.annotations.NotNull;
+import org.jetbrains.annotations.Range;
+
+/**
+ * Called for every tick an entity is damaging a door.
+ */
+public class EntityDamageDoorEvent extends EntityEvent implements Cancellable {
+
+    private static final HandlerList HANDLER_LIST = new HandlerList();
+
+    private final BlockData damagedDoor;
+    private boolean cancelled;
+    private int breakTime;
+    private final int doorBreakTime;
+    private boolean playEffect;
+
+    @ApiStatus.Internal
+    public EntityDamageDoorEvent(final @NotNull Entity what, final @NotNull BlockData damagedDoor, final int breakTime, final int doorBreakTime, boolean playEffect) {
+        super(what);
+        this.damagedDoor = damagedDoor;
+        this.breakTime = breakTime;
+        this.doorBreakTime = doorBreakTime;
+        this.playEffect = playEffect;
+    }
+
+    /**
+     * Get the {@link BlockData} representing the Door
+     * currently being damaged by the entity.
+     *
+     * @return The door being damaged.
+     */
+    @NotNull
+    public BlockData getDamagedDoor() {
+        return this.damagedDoor;
+    }
+
+    /**
+     * Get the value indicating the ticks spent
+     * breaking this door.
+     * This will return 0 when the breaking progress starts.
+     *
+     * @return The breaking progress value.
+     */
+    @Range(from = 0, to = Integer.MAX_VALUE)
+    public int getBreakTime() {
+        return this.breakTime;
+    }
+
+    /**
+     * Set the current progress in ticks that
+     * this entity has spent damaging the door.
+     *
+     * @param breakTime The ticks spent damaging the door.
+     */
+    public void setBreakTime(@Range(from = 0, to = Integer.MAX_VALUE) final int breakTime) {
+        Preconditions.checkArgument(breakTime >= 0, "The breaking progress must be at least 0!");
+        Preconditions.checkArgument(breakTime < this.doorBreakTime, "The door breaking time cannot be greater than or equal to the amount of ticks required to break the door!");
+        this.breakTime = breakTime;
+    }
+
+    /**
+     * Get the total amount of ticks required to break
+     * the door that the entity is currently damaging.
+     *
+     * @return The amount of ticks necessary for the entity to break the door.
+     */
+    @Range(from = 0, to = Integer.MAX_VALUE)
+    public int getDoorBreakTime() {
+        return this.doorBreakTime;
+    }
+
+    /**
+     * Returns if this should play an effect when damaging the door.
+     * This includes the sound, and arm swing (if the entity isn't currently swinging)
+     *
+     * @return will play effect
+     */
+    public boolean playsEffect() {
+        return this.playEffect;
+    }
+
+    /**
+     * Sets if this should play an effect when damaging the door.
+     * This includes the sound, and arm swing (if the entity isn't currently swinging)
+     *
+     * @param playEffects will play effect
+     */
+    public void playsEffect(final boolean playEffects) {
+        this.playEffect = playEffects;
+    }
+
+    @Override
+    public boolean isCancelled() {
+        return this.cancelled;
+    }
+
+    /**
+     * Cancelling this event will reset the break progress of this door.
+     *
+     * @param cancel true if you wish to cancel this event
+     */
+    @Override
+    public void setCancelled(final boolean cancel) {
+        this.cancelled = cancel;
+    }
+
+    @Override
+    public @NotNull HandlerList getHandlers() {
+        return HANDLER_LIST;
+    }
+
+    @NotNull
+    public static HandlerList getHandlerList() {
+        return HANDLER_LIST;
+    }
+}
